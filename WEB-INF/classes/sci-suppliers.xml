<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap>
	
	<update id="addSuppliersSql" parameterClass="java.util.Map">
		INSERT INTO `suppliers` (supp_code, supp_name)
			VALUES (#supp_code#, #supp_name#)
	</update>

	<update id="updateSuppliersSql" parameterClass="java.util.Map">
		UPDATE `suppliers` SET
			 supp_code = #supp_code#
			,supp_name = #supp_name#
		  WHERE supp_id = #supp_id#
	</update>

	<update id="updateSuppliersByIsDeletedSql" parameterClass="java.util.Map">
		UPDATE `suppliers` SET
			 status = #status#
		  WHERE supp_id = #supp_id#
	</update>
	
	<select id="getAllSuppliersSql" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="false">
		SELECT 
			supp_id,
			supp_code,
			supp_name,
			DATE_FORMAT(date_modified, '%m/%d/%Y %r') AS date_modified
		FROM `suppliers` 
		WHERE `status` = 1
			<dynamic>
			  	<isNotEmpty property="supp_id" prepend="AND">
			  		supp_id = #supp_id#
			  	</isNotEmpty>
			</dynamic>
			
			ORDER BY supp_name
	</select>

	<select id="getSuppliersByCodeSql" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="false">
		SELECT * 
		FROM `suppliers`
		WHERE `status` = 1
			AND supp_code = #supp_code#
			<dynamic>
			  	<isNotEmpty property="supp_id" prepend="AND">
			  		supp_id != #supp_id#
			  	</isNotEmpty>
			</dynamic>
	</select>

	<select id="getSuppliersByNameSql" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="false">
		SELECT * FROM `suppliers`
			WHERE supp_name = #supp_name#
	</select>

	<select id="getSuppliersSummaryByProdIdSql" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="false">
		SELECT * 
			FROM `weight_readings` a
			JOIN `suppliers` b USING (`supp_id`)
			JOIN `products` c USING (`prod_id`)
			WHERE b.`status` = 1
		<dynamic>
		  	<isNotEmpty property="startDate" prepend="AND">
		  		DATE_FORMAT(a.`weight_in_date`, '%m/%d/%Y') 
		  		BETWEEN #startDate# AND #endDate#
		  	</isNotEmpty>
		</dynamic>

	</select>
	
</sqlMap>
	