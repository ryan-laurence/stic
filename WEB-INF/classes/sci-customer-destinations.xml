<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap>
	
	<update id="addCustDestSql" parameterClass="java.util.Map">
		INSERT INTO `customer_destinations` (cust_id, dest_id)
			VALUES (#cust_id#, #dest_id#)
	</update>

	<update id="updateCustDestSql" parameterClass="java.util.Map">
		UPDATE `customer_destinations` SET
			 cust_id = #cust_id#
			,dest_id = #dest_id#
		  WHERE cd_id = #cd_id#
	</update>

	<update id="updateCustDestByIsDeletedSql" parameterClass="java.util.Map">
		UPDATE `customer_destinations` SET
			 status = #status#
		  WHERE cd_id = #cd_id#
	</update>
	
	<select id="getAllCustDestSql" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="false">
		SELECT 
			cd.cd_id, 
			cd.cust_id, 
			cd.dest_id, 
			cd.status, 
			d.dest_zipcode, 
			d.dest_name, 
			d.dest_location,
			DATE_FORMAT(cd.date_modified, '%m/%d/%Y %r') AS date_modified
		FROM customer_destinations cd
		LEFT JOIN destinations d ON d.dest_id = cd.dest_id 
		WHERE cd.status = 1
		<dynamic>
		  	<isNotEmpty property="cd_id" prepend="AND">
		  		cd.cust_id = #cd_id#
		  	</isNotEmpty>
		</dynamic>
	</select>

</sqlMap>
	