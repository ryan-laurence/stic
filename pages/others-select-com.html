<div class="row" style="margin-top: 50px;">
	<div class="col-md-6 col-centered">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<i class="fa fa-cog"></i> Set Communication Port
			</div>
			<div class="panel-body">
				<form class="form-horizontal well no-margin-bottom">
					<div class="form-group">
						<label for="inputCommunication" class="col-md-4 control-label">Communication </label>
						<div class="col-md-7 no-padding-left">
							<select class="form-control" data-field="port">
								<option value="COM1" selected>COM1</option>
								<option value="COM2">COM2</option>
								<option value="COM3">COM3</option>
								<option value="COM4">COM4</option>
								<option value="COM5">COM5</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label for="inputBaudrate" class="col-md-4 control-label">Baudrate </label>
						<div class="col-md-7 no-padding-left">
							<select class="form-control" data-field="baudrate">
								<option value="2400" selected>2400</option>
								<option value="4800">4800</option>
								<option value="9600">9600</option>
								<option value="19200">19200</option>
								<option value="38400">38400</option>
							</select>
						</div>
					</div>		
					<input type="hidden" data-field="id">
					<input type="hidden" data-field="delay_time_second">
					<input type="hidden" data-field="minimum_truck_weight">
					<input type="hidden" data-field="zero_range">
					<input type="hidden" data-field="bridge_code">
					<input type="hidden" data-field="current_docket_number">
					<input type="hidden" data-field="port_baudrate">
					<input type="hidden" data-field="weight_unit">
					<input type="hidden" data-field="contact_person">
					<input type="hidden" data-field="company_name">
					<input type="hidden" data-field="company_address">
					<div class="form-group">				
						<div class="footer-line-divider "></div>					
					</div>
					<div class="form-group no-margin-bottom">
						<button type="button" class="btn btn-primary" id="save-com-port"><i class="fa fa-floppy-o"></i> Save</button>
						<button type="button" class="btn btn-default" id="reset-com-port"><i class="fa fa-ban"></i> Cancel</button>
					</div>
				</form>				
			</div>
		</div>
	</div>
</div>
<script>
	$(function() {	
		// Pre Load Values
		function loadComPort() {
			$.get(WS_LIST_CONFIG_COMPANY, function(data) { 
				$.each(data.response, function(a, b) {
					if (a == 'company-list') {
						$.each(b, function(c, d) {		
							$.each(d, function(e, f) {	
								$('input[data-field="' + e + '"]').val(f);
							});	
							var pb = d.port_baudrate,
								pbx = pb.split('=');
							$('select[data-field="port"]').val(pbx[0]);
							$('select[data-field="baudrate"]').val(pbx[1]);
						});
					}
				});		
			});		
		}		
		loadComPort();
		
		// Save
		$('#save-com-port').on('click', function() {
			BootstrapDialog.confirm({
				title: MSG_TITLE_CONFIRM_SAVE,
				message: MSG_CONFIRM_SAVE_COM_PORT,			
				callback: function(result) {
					if (result) {
						var jsonString = '',
							jsonObject = {},
							port = $('select[data-field="port"]').val(),
							baudrate =  $('select[data-field="baudrate"]').val();								
						$('input[data-field="port_baudrate"]').val(port + '=' + baudrate);
						$.each($('input[data-field]'), function(index, formElement) {
							var postString = '{"' + $(formElement).attr('data-field') + '":"' + $(formElement).val() + '"}';
							$.extend(jsonObject, $.parseJSON(postString)); 
						});
						jsonString = 'companyInfo=' + JSON.stringify(jsonObject);
						$.post(WS_UPDATE_CONFIG_COMPANY, jsonString, function(data, status){
							BootstrapDialog.alert({
								title: MSG_INFO_TITLE,
								message: 'Communication Port settings were updated successfully.',	
								type: BootstrapDialog.TYPE_PRIMARY
							});
							loadComPort();
						});
					} 
				}
			});
		});
		
		// Reset
		$('#reset-com-port').on('click', function() {
			loadComPort();
		});
	});
</script>