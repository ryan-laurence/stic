<div class="panel panel-primary">
	<div class="panel-heading">
		<i class="fa fa-pencil-square-o"></i> Customer Data
	</div>
	<div class="panel-body">
		<div class="alert alert-info" role="alert">
			<i class="fa fa-info-circle fa-3x fa-pull-left"></i>
			<ul>
				<li><i class="fa fa-check-square-o"></i> All Customer Details and Products listed here will be available for selection in the Weighing Scale form.</li>
				<li><i class="fa fa-check-square-o"></i> Use this page to manage Customer Details and Products that are available in the system.</li>
			</ul>
		</div>
		<div class="panel panel-default" style="margin-bottom: 5px">
			<div class="panel-heading">
				<i class="fa fa-info-circle"></i> <strong>Customer Details</strong>
			</div>
			<div class="panel-body">
				<table class="display compact nowrap" id="table-customer">
					<thead>
						<tr>
							<th class="text-left">Customer ID</th>
							<th class="text-left">Customer Code</th>
							<th class="text-left">Customer Name</th>
							<th class="text-left">Date Modified</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
		<div class="panel panel-default" style="margin-bottom: 10px">
			<div class="panel-heading">
				<i class="fa fa-th-large"></i> <strong>Customer Products</strong>
			</div>
			<div class="panel-body" id="panel-content-products">
				<table class="display compact nowrap" id="table-custprod-data">
					<thead>
						<tr>
							<th class="text-left">CP ID</th>
							<th class="text-left">Product ID</th>
							<th class="text-left">Customer ID</th>
							<th class="text-left">Product Code</th>
							<th class="text-left">Product Name</th>
							<th class="text-left">Category Name</th>
							<th class="text-left">Date Modified</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="js/stic-data-custom.js"></script>
<script>
	$(function() {
		// Customer Details DT
		var dtCustomer = loadCustomerData({
			pkey: 'cust_id',
			objectId: 'custInfo',
			modTitle: 'Customer Data',
			formId: '#dataCustomerForm',
			formSrc: FORM_CUSTOMER_DATA,
			showAllBtns: true,
			cd: CD_CUSTOMER_LIST,
			ds: DS_CUSTOMER_LIST,
			wsList: WS_CUSTOMER_LIST,
			wsInsert: WS_CUSTOMER_INSERT,
			wsUpdate: WS_CUSTOMER_UPDATE,
			wsDelete: WS_CUSTOMER_DELETE
		});

		// Customer Products DT
		var dtCustProd = loadDestProdData({
			pkey1: 'prod_id',
			pkey2: 'cp_id',
			objectId1: 'custProdInfo',
			objectId2: 'custProdId',
			domId1: 'table-custprod-data',
			domId2: 'table-product-data',
			cd1: CD_CUSTPROD_LIST,
			cd2: CD_PRODUCT_LIST,
			ds1: DS_CUSTPROD_LIST,
			ds2: DS_PRODUCT_LIST,
			wsList1: WS_CUSTPROD_LIST + 'cust_id=0',
			wsList2: WS_PRODUCT_LIST,
			wsInsert: WS_CUSTPROD_INSERT,
			wsDelete: WS_CUSTPROD_DELETE,
			modTitle: 'Product Details',
			formSrc: PICKER_CUSTPROD_DATA,
			dtCustomer: dtCustomer
		});

		// Customer DT onDraw event
		dtCustomer.on('draw.dt', function (e, settings, data) {
			dtCustProd.clear().draw();
			dtCustProd.buttons().disable();
			dtCustomer.$('tr.selected').removeClass('selected');
		});

		// Customer Products DT onDraw event
		dtCustProd.on('draw.dt', function (e, settings, data) {
			dtCustProd.button('delete:name').disable();
		});

		// Customer > Data Table > Row Click Event
		$('#table-customer tbody').on( 'click', 'tr', function () {
			var row = dtCustomer.row(this).data(),
				custId = row.cust_id,
				custCode = row.cust_code,
				custName = row.cust_name,
				custProdURL = WS_CUSTPROD_LIST + 'cust_id=' + custId;

			// Reload DT based on selected customer
			if (custId != '') {
				if ($(this).hasClass('selected')) {
					$(this).removeClass('selected');
					dtCustProd.clear().draw();
					dtCustProd.buttons().disable();
					dtCustomer.buttons(['edit:name', 'delete:name']).disable();
				} else {
					dtCustomer.$('tr.selected').removeClass('selected');
					$(this).addClass('selected');
					dtCustProd.ajax.url(custProdURL).load();
					dtCustProd.buttons(['new:name', 'reload:name']).enable();
					dtCustomer.buttons(['edit:name', 'delete:name']).enable();
				}
			}
		});
	});
</script>