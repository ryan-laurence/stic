<div class="panel panel-primary">
	<div class="panel-heading">
		<i class="fa fa-table"></i> Custom Summary
	</div>
	<div class="panel-body">
		<div class="alert alert-info" role="alert">
			<h5 class="no-margin-top"><i class="fa fa-info-circle"></i> <strong>Note(s):</strong></h5>	
			<ul>
				<li><i class="fa fa-check-square-o"></i> Choose the type of report from the "Filter By" dropdown menu to generate the needed summary report.</li>
				<li><i class="fa fa-check-square-o"></i> Click the "Print" button to have a printed copy of the summary report.</li>
			</ul>
		</div>
		<div class="panel panel-default no-margin-bottom">
			<div class="panel-body">
				<table class="display compact" id="table-summary">
					<thead>
						<tr>
							<th class="text-left">Docket No.</th>
							<th class="text-left">Product Name</th>
							<th class="text-left">Customer Name</th>
							<th class="text-left">Truck Code</th>
							<th class="text-left">User</th>
							<th class="text-left">Weight In</th>
							<th class="text-left">Weight Out</th>
							<th class="text-left">Net Weight</th>
							<th class="text-left">Unit</th>
							<th class="text-left">Comp.(%)</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<script>
	$(function () {	
		// DT options
		var dtCols = CD_SUMMARY_CUSTOM_DOCKET,			
			dtAjx = { 'url': WS_SUMMARY_CUSTOM_DOCKET, 
				'dataSrc': function(json) {
					var ds = DEFAULT_DS_REPORTS.split('.'),
						rec = json[ds[0]][ds[1]][ds[2]];				
					return ($.isArray(rec) === true ? rec :(rec !== '' ? [rec] : []));
				}};
				
		// DT Initial
		var dtSummary = $('#table-summary')
			.DataTable({	
				'dom': '<"toolbar">BRlfrtip',
				'ordering': true,
				'searching': false,
				'processing': true,
				'lengthChange': false,
				'pageLength': 10,
				'ajax': dtAjx,				
				'columns': dtCols,
				colReorder: {
					order: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
				},
				buttons: [{
					name: 'print',
					extend: 'print',
					enabled: false,					
					autoPrint: true,
					className: 'btn-primary',	
					text: '<span class="glyphicon glyphicon-print" aria-hidden="true"></span> Print',
					customize: dtPrintCustom
				}, {						
					name: 'reload',
					text: '<i class="fa fa-refresh"></i> Refresh',						
					className: 'btn-primary',
					action: function(e, dt, node, config) {
						dt.ajax.reload();
					}	
				}]
			})
			.on('draw.dt', function (e, settings, data) {
				if (dtSummary.data().length > 0) 
					dtSummary.button('print:name').enable();
				else
					dtSummary.button('print:name').disable();
			});	

		$('div.toolbar').css('float', 'left');
		$('div.dt-buttons').css('float', 'left');
		$('div.dt-buttons').css('padding-left', '5px');

		$('div.toolbar').load('pages/summary-custom-filter.html', 
			function(response, status, xhr) {		
				var ordering = [];
				ordering.push([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);
				ordering.push([3, 0, 1, 2, 4, 5, 6, 7, 8, 9]);
				ordering.push([1, 0, 2, 3, 4, 5, 6, 7, 8, 9]);
				ordering.push([4, 0, 1, 2, 3, 5, 6, 7, 8, 9]);
				ordering.push([2, 0, 1, 3, 4, 5, 6, 7, 8, 9]);
				
				// Change ordering based on filter
				$('#report-filter').on('change', function() {	
					dtSummary.colReorder.reset();	
					dtSummary.colReorder.order(ordering[$('#report-filter option:selected').attr('data-index')]);
				});
		
				// Search Action
				$('button[data-btn="btnSrchRpt"]').on('click', function() {						
					if ($('#report-query').val() == '') {
						dtSummary.ajax.url(WS_SUMMARY_CUSTOM_DOCKET).load();
						dtSummary.colReorder.reset();
						$('#report-filter').selectpicker('refresh');
						$('#report-filter').selectpicker('val', 'docket_no');
					} else {
						dtSummary.ajax.url(WS_SUMMARY_CUSTOM_DOCKET + 
							'fieldName=' + $('#report-filter').val() + 
							'&fieldId=' + $('#report-query').val())
						.load();
					}
				});
			});
		
		// Customize Print Preview
		function dtPrintCustom(win) {	
			var title = 'Weighing Record';
			$(win.document.body)
				.css('background', 'transparent')
				.css('font-weight', 'normal')
				.css('font-family', '"Trebuchet MS", Helvetica, sans-serif');				
			$(win.document.body).find('h1')								
				.css('font-size', '16pt')
				.css('text-align', 'center')
				.html(title);							
			$(win.document.body).find('div')							
				.css('font-size', '11pt')
				.css('text-align', 'left')
				.css('margin', '20px 0px 15px 0px');						
			$(win.document.body).find('table')
				.removeClass('display')
				.removeClass('compact');							
			$(win.document.body).find('table th')
				.css('font-size', '11pt')
				.css('text-align', 'left')
				.css('padding-left', '0px');							
			$(win.document.body).find('table td')							
				.css('font-size', '10pt')
				.css('text-align', 'left')
				.css('padding-left', '0px')
				.css('padding-top', '10px')
				.css('padding-bottom', '10px')
				.css('font-weight', 'normal');							
		}
	});
</script>