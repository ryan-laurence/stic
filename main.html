<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Weighing System 2.0</title>
    <!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="css/bootstrap.css" />	
	<link rel="stylesheet" href="css/bootstrap-select.min.css" />
	<link rel="stylesheet" href="css/bootstrap-dialog.css" />	
	<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css" />
	 <!-- Font Awesome CSS -->
	<link rel="stylesheet" href="css/font-awesome.min.css" />
	<!-- JQuery DataTable styles -->	
	<link rel="stylesheet" href="css/dataTables.css" />
	<link rel="stylesheet" href="css/dataTables.colReorder.min.css" />	
	<link rel="stylesheet" href="css/dataTables.buttons.css" />
	<link rel="stylesheet" href="css/bootstrap.buttons.css" />   
	<!-- Custom styles -->
  </head>
  <body>
		<nav class="navbar navbar-inverse">
			<div class="container">
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li><a href="#" data-mod-name="weight-scale"><i class="fa fa-balance-scale"></i> Weighing</a></li>
						<li><a href="#" data-mod-name="truck-in"><i class="fa fa-truck"></i> Truck In</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-pencil-square-o"></i> Edit Data <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="#" data-mod-name="data-supplier">Supplier Data</a></li>
								<li><a href="#" data-mod-name="data-category">Category Data</a></li>
								<li><a href="#" data-mod-name="data-customer">Product Data</a></li>
								<li><a href="#" data-mod-name="data-truck">Truck Data</a></li>
								<li><a href="#" data-mod-name="data-user">User Data</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-table"></i> Summary <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="#" data-mod-name="summary-supplier">Supplier Summary</a></li>
								<li><a href="#" data-mod-name="summary-customer">Customer Summary</a></li>
								<li><a href="#" data-mod-name="summary-destination">Destination Summary</a></li>
								<li><a href="#" data-mod-name="summary-product">Product Summary</a></li>
								<li><a href="#" data-mod-name="summary-reprint-count">Reprint Count</a></li>
								<li class="divider"></li>
								<li><a href="#" data-mod-name="summary-truck">Truck Summary</a></li>
								<li><a href="#" data-mod-name="summary-detailed-truck">Detailed Truck Summary</a></li>
								<li class="divider"></li>
								<li><a href="#" data-mod-name="summary-custom">Custom Report</a></li>
								<li class="divider"></li>
								<li><a href="#" data-mod-name="summary-event-log">Event Log</a></li>
								<!--li><a href="#" data-mod-name="erase-data">Erase Data</a></li-->
							</ul>
						</li>
						<li><a href="#" data-mod-name="docket-template-main"><i class="fa fa-file-text-o"></i> Docket</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-cog"></i> Others <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="#" data-mod-name="others-select-com">Select Com</a></li>
								<li><a href="#" data-mod-name="others-system-config">System Config</a></li>
								<li><a href="#" data-mod-name="others-calibration">Calibration</a></li>
								<li><a href="#" data-mod-name="others-backup-data">Backup Data</a></li>
								<li><a href="#" data-mod-name="others-restore-data">Restore Data</a></li>
							</ul>
						</li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<li><a href="#" id="link-user"><i class="fa fa-user"></i> User: <span id="current-user" style="font-weight: bold">Admin</span></a></li>
						<li><a href="#" id="link-exit"><i class="fa fa-sign-out"></i> Logout</a></li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="container" id="main-wrapper"></div>	
		<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-labelledby="alertModal" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="alert-title"></h4>
					</div>
					<div class="modal-body">
						<div class="alert alert-success alert-dismissible" role="alert" id="alert-message"></div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Close</button>
					</div>
				</div>
			</div>
		</div>		
		<script src="js/jquery/jquery.min.js"></script>
		<script src="js/jquery/jquery.widget.min.js"></script>
		<script src="js/jquery/jquery.dataTables.js"></script>
		<script src="js/jquery/dataTables.colReorder.min.js"></script>		
		<script src="js/jquery/dataTables.buttons.min.js"></script>		
		<script src="js/jquery/buttons.print.min.js"></script>		
		<script src="js/jquery/buttons.bootstrap.min.js"></script>
		<script type="text/javascript" src="js/moment.min.js"></script>
		<script type="text/javascript" src="js/transition.js"></script>
		<script type="text/javascript" src="js/collapse.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-dialog.min.js"></script>		
		<script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-select.min.js"></script>	
		<script type="text/javascript" src="js/jquery.formatDateTime.min.js"></script>
		<script type="text/javascript" src="js/jquery.MyDigitClock.js"></script>
		<script type="text/javascript" src="js/stic-constants.js"></script>
		<script type="text/javascript" src="js/stic-functions.js"></script>
		<script type="text/javascript" src="js/scaletech-functions.js"></script>	
		<script type="text/javascript" src="js/validator.min.js"></script>			
		<script type="text/javascript">
			$(function () { 	
				// Check Cookies				
				if (readCookie('userid') === null) {
					window.location = DEFAULT_ROOT;
				} else {
					var sUserName = '', userId = '';
					sUserName = readCookie('username');
					userId = readCookie('userid');
					notFoundContextSave(userId, sUserName);
					$('#current-user').text(sUserName);
				}	
				
				// New Page Call Function!
				$('[data-mod-name]').on('click', function() { 
					STIC.loadPage({ 'page_name': $(this).attr('data-mod-name') });
				});
				
				// Custom Call for un-developed pages
				$('[data-mod-name="others-calibration"]').on('click', function() {
					var page = $(this).attr('data-mod-name');
					BootstrapDialog.alert({
						title: '<i class="fa fa-info-circle"></i> System Info',
						message: 'Sorry, the page [' + page + '] is not yet available.'
					});
				});
				
				// Change Password
				$('#link-user').on('click', function() {
					BootstrapDialog.show({
						closable: false,
						title: '<i class="fa fa-lock"></i> Change Password',
						message: $('<div></div>').load(FORM_CHANGE_PASS_DATA),			
						buttons: [{
							label: 'Save',
							icon: 'fa fa-floppy-o',
							cssClass: 'btn-primary',
							onshown: function(dialogItself) {
								$('#data-form').validator();
							},
							action: function(dialogItself) {
								var user = readCookie('username'),
									oldPass = $('#form-change-pass input[data-field="old_password"]').val(),
									newPass = $('#form-change-pass input[data-field="new_password"]').val(),
									confPass = $('#form-change-pass input[data-field="confirm_password"]').val(),
									JSONString = { user_name: user, user_password: oldPass };
								if (newPass != confPass) {
									BootstrapDialog.alert({
										title: MSG_ERROR_TITLE,
										message: 'Passwords dont match!',
										type: BootstrapDialog.TYPE_DANGER
									});
								} else {
									console.log('Check: ' + JSON.stringify(JSONString));
									$.post(WS_USER_PASS_CHECK, JSONString, 
										function(data, status, jqXHR) {
											var result = $.parseJSON(jqXHR.responseText);
											if (result.response.type == 'SUCCESS') {
												var userid = readCookie('userid'),
													JSONString = { userId: userid, password: newPass };
												console.log('Update: ' + JSON.stringify(JSONString));
												$.post(WS_USER_PASS_UPDATE, JSONString, 
													function(data, status, jqXHR) {
														var result = $.parseJSON(jqXHR.responseText);
														if (result.response.type == 'SUCCESS') {
															BootstrapDialog.alert({
																title: MSG_INFO_TITLE,
																message: 'Password was changed successfully.',
																type: BootstrapDialog.TYPE_PRIMARY,
																callback: function() {
																	$('#form-change-pass input[data-field]').val('');
																	BootstrapDialog.closeAll();	
																	logout();
																}
															});
														} else {
															BootstrapDialog.alert({
																title: MSG_WS_ERROR_TITLE,
																message: MSG_WS_ERROR_INFO,
																type: BootstrapDialog.TYPE_DANGER
															});
														}
													});
											} else {
												BootstrapDialog.alert({
													title: '<i class="fa fa-exclamation-circle"></i> Password Error',
													message: 'Old password is invalid. Please enter the correct password to continue.',
													type: BootstrapDialog.TYPE_DANGER
												});
											}
										});
								}
							}
						}, {
							label: 'Cancel',
							icon: 'fa fa-ban',
							cssClass: 'btn-primary',
							action: function(dialogItself) {
								BootstrapDialog.closeAll();
							}
						}]
					});
				});
				
				// Logout
				$('#link-exit').click(function() {	
					BootstrapDialog.confirm({
						title: '<i class="fa fa-sign-out"></i> Confirm Logout',
						message: 'Are you sure you want to logout?',			
						callback: function(result) {
							if (result) {
								logout();
							} 
						}
					});
				});		
			});
		</script>	
	</body>
</html>